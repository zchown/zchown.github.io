name: Build and Deploy Elm to GitHub Pages
on:
  push:
    branches: [main]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18
      
      - name: Install Elm
        run: npm install -g elm
      
      - name: Create docs directory if it doesn't exist
        run: mkdir -p docs
      
      - name: Create index.html if it doesn't exist
        run: |
          if [ ! -f docs/index.html ]; then
            cat > docs/index.html << 'EOF'
            <!DOCTYPE html>
            <html>
              <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Elm App</title>
                <style>
                  body {
                    margin: 0;
                    padding: 0;
                    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
                  }
                </style>
              </head>
              <body>
                <div id="elm-app"></div>
                <script src="./main.js"></script>
                <script>
                  var app = Elm.Main.init({
                    node: document.getElementById('elm-app')
                  });
                </script>
              </body>
            </html>
            EOF
          fi
      
      - name: Build Elm to docs/
        run: elm make src/Main.elm --optimize --output=docs/main.js
      
      - name: Create .nojekyll file
        run: touch docs/.nojekyll
      
      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: docs
          branch: gh-pages
